# MongoDB에서 OpenSearch로 데이터 전송 (간단 버전)

input {
  # HTTP 입력
  http {
    port => 8080
    codec => json
  }
  
  # TCP 입력
  tcp {
    port => 5000
    codec => json
  }
}

filter {
  # 기본 필드 추가
  mutate {
    add_field => { "source" => "mongodb" }
    add_field => { "processed_at" => "%{@timestamp}" }
  }
  
  # 컬렉션별 처리
  if [collection] == "customers" {
    mutate {
      add_field => { "data_type" => "customer" }
    }
  } else if [collection] == "transactions" {
    mutate {
      add_field => { "data_type" => "transaction" }
    }
  } else if [collection] == "system_logs" {
    mutate {
      add_field => { "data_type" => "system_log" }
    }
  }
}

output {
  # OpenSearch로 데이터 전송
  opensearch {
    hosts => [ "https://opensearch:9200" ]
    user => "admin"
    password => "Kcb2025opSLabAi9"
    ssl => true
    ssl_certificate_verification => false
    index => "mongodb-%{+YYYY.MM.dd}"
  }
  
  # 디버깅용 로그
  stdout {
    codec => rubydebug
  }
}
