# http://opensearch.local/  → OpenSearch Dashboards
# http://opensearch.local/es → OpenSearch API (HTTPS를 Nginx가 프록시)

server {
    listen 80;
    server_name opensearch.local;

    # Dashboards (5601)
    location / {
        proxy_pass http://opensearch-dashboards:5601/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_read_timeout 300;
        client_max_body_size 200M;
    }

    # OpenSearch API (9200, HTTPS → Nginx는 백엔드로 http가 아닌 https에 -k 유사 옵션 불가)
    # 간단히 stream/TCP 프록시가 아니면 인증서 이슈가 있으니, 여기선 curl은 직접 9200으로, 브라우저는 대시보드 사용 추천.
    # 필요하면 Nginx stream 모듈(별도 설정) 또는 opensearch 보안 비활성화로 대체(비추).

    add_header Access-Control-Allow-Origin *;
}
